<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Mael Uber</title>

  <!-- Faz o site se adaptar ao tamanho da tela de qualquer dispositivo -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Importa o CSS do Leaflet (mapa) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    /* Remove margens e define altura e largura total do body e html */
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: column; /* organiza header, mapa e footer em coluna */
    }

    /* Estilo do cabe√ßalho */
    header {
      background: #0e0f0f; /* cor de fundo preto escuro */
      color: white; /* cor do texto */
      text-align: center;
      padding: 12px;
      font-size: 20px;
      font-weight: bold;
    }

    /* O mapa ocupa todo o espa√ßo dispon√≠vel entre header e footer */
    #map {
      flex: 1;
      width: 100%;
    }

    /* Estilo do rodap√© */
    footer {
      text-align: center;
      padding: 10px;
      background: #f0f0f0; /* cor clara de fundo */
    }

    /* Estilo do bot√£o */
    button {
      background: #1e88e5; /* cor azul */
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    /* Efeito ao passar o mouse sobre o bot√£o */
    button:hover {
      background: #1568b4; /* azul mais escuro */
    }

    /* Estilo da div de cobran√ßa */
    #cobranca {
      margin-top: 10px;
      text-align: center;
    }

    /* ‚ÄúCart√£o‚Äù atr√°s de toda a frase da cobran√ßa */
    #valorTotal {
      background-color: #1e88e5; /* azul igual ao bot√£o */
      color: white;
      padding: 12px 20px; /* mais espa√ßo interno */
      border-radius: 12px; /* bordas mais arredondadas */
      font-weight: bold;
      display: inline-block;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* sombra suave */
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <!-- Cabe√ßalho do app -->
  <header>Mael Uber</header>

  <!-- Div onde o mapa ser√° renderizado -->
  <div id="map"></div>

  <!-- Rodap√© com bot√£o de iniciar corrida -->
  <footer>
    <button onclick="iniciarCorrida()">Iniciar Corrida</button>

    <!-- Div para mostrar valor da corrida -->
    <div id="cobranca">
      <h3><span id="valorTotal">Valor da corrida: R$ <span id="valor">0.00</span></span></h3>
    </div>
  </footer>

  <!-- Importa o JS do Leaflet -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Cria o mapa centralizado inicialmente nas coordenadas [0,0] com zoom 13
    const map = L.map('map').setView([0, 0], 13);

    // Adiciona camada de mapa do OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    // Vari√°veis para guardar origem, destino, rota e marcador do destino
    let origem, destino, rota;
    let marcadorDestino; // marcador do destino

    // Pega a localiza√ß√£o atual do usu√°rio
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        origem = [pos.coords.latitude, pos.coords.longitude]; // latitude e longitude
        map.setView(origem, 15); // centraliza mapa na localiza√ß√£o
        L.marker(origem).addTo(map).bindPopup("Voc√™ est√° aqui!").openPopup(); // adiciona marcador
      });
    }

    // Fun√ß√£o para calcular o valor da corrida
    function calcularCobranca(origem, destino) {
      // Calcula dist√¢ncia em metros
      const distanciaMetros = map.distance(origem, destino);

      // Converte para km
      const distanciaKm = distanciaMetros / 1000;

      // Define tarifa por km
      const tarifa = 2.5; // R$ 2,50 por km

      // Calcula valor total
      const valorTotal = distanciaKm * tarifa;

      // Mostra na tela com 2 casas decimais
      document.getElementById("valor").textContent = valorTotal.toFixed(2);
    }

    // Evento de clique no mapa para escolher o destino
    map.on('click', async (e) => {
      destino = [e.latlng.lat, e.latlng.lng]; // pega coordenadas do clique

      // Remove marcador antigo do destino, se existir
      if (marcadorDestino) {
        map.removeLayer(marcadorDestino);
      }

      // Adiciona novo marcador e guarda na vari√°vel
      marcadorDestino = L.marker(destino).addTo(map).bindPopup("Destino").openPopup();

      // Se origem e destino estiverem definidos, tra√ßa a rota
      if (origem && destino) {
        const url = `https://router.project-osrm.org/route/v1/driving/${origem[1]},${origem[0]};${destino[1]},${destino[0]}?overview=full&geometries=geojson`;
        const response = await fetch(url);
        const data = await response.json();
        const coords = data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]);

        // Remove rota antiga, se existir
        if (rota) map.removeLayer(rota);

        // Desenha nova rota no mapa
        rota = L.polyline(coords, {color: 'blue'}).addTo(map);

        // Ajusta o zoom para caber toda a rota na tela
        map.fitBounds(rota.getBounds());

        // Calcula e mostra cobran√ßa
        calcularCobranca(origem, destino);
      }
    });

    // Fun√ß√£o chamada ao clicar no bot√£o "Iniciar Corrida"
    function iniciarCorrida() {
      if (origem && destino) {
        // Mostra alerta com origem, destino e valor da corrida
        const valor = document.getElementById("valor").textContent;
        alert(`üöñ Corrida iniciada!\nOrigem: ${origem}\nDestino: ${destino}\nValor: R$ ${valor}`);
      } else {
        // Caso usu√°rio n√£o tenha escolhido destino ainda
        alert("‚ö†Ô∏è Escolha um destino clicando no mapa antes de iniciar a corrida!");
      }
    }
  </script>
</body>
</html>
