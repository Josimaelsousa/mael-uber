<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Mael Uber</title>

  <!-- Faz o site se adaptar ao tamanho da tela de qualquer dispositivo -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Importa o CSS do Leaflet (mapa) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    /* Remove margens e define altura e largura total do body e html */
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      display: flex;
      flex-direction: column; /* organiza header, mapa e footer em coluna */
    }

    /* Estilo do cabe√ßalho */
    header {
      background: #0e0f0f; /* cor de fundo preto escuro */
      color: white; /* cor do texto */
      text-align: center;
      padding: 12px;
      font-size: 20px;
      font-weight: bold;
    }

    /* O mapa ocupa todo o espa√ßo dispon√≠vel entre header e footer */
    #map {
      flex: 1;
      width: 100%;
    }

    /* Estilo do rodap√© */
    footer {
      text-align: center;
      padding: 10px;
      background: #f0f0f0; /* cor clara de fundo */
    }

    /* Estilo do bot√£o */
    button {
      background: #1e88e5; /* cor azul */
      color: white;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    /* Efeito ao passar o mouse sobre o bot√£o */
    button:hover {
      background: #1568b4; /* azul mais escuro */
    }
  </style>
</head>
<body>
  <!-- Cabe√ßalho do app -->
  <header>Mael Uber</header>

  <!-- Div onde o mapa ser√° renderizado -->
  <div id="map"></div>

  <!-- Rodap√© com bot√£o de iniciar corrida -->
  <footer>
    <button onclick="iniciarCorrida()">Iniciar Corrida</button>
  </footer>

  <!-- Importa o JS do Leaflet -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Cria o mapa centralizado inicialmente nas coordenadas [0,0] com zoom 13
    const map = L.map('map').setView([0, 0], 13);

    // Adiciona camada de mapa do OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    // Vari√°veis para guardar origem, destino e rota
    let origem, destino, rota;

    // Pega a localiza√ß√£o atual do usu√°rio
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        origem = [pos.coords.latitude, pos.coords.longitude]; // latitude e longitude
        map.setView(origem, 15); // centraliza mapa na localiza√ß√£o
        L.marker(origem).addTo(map).bindPopup("Voc√™ est√° aqui!").openPopup(); // adiciona marcador
      });
    }

    // Evento de clique no mapa para escolher o destino
    map.on('click', async (e) => {
      destino = [e.latlng.lat, e.latlng.lng]; // pega coordenadas do clique
      L.marker(destino).addTo(map).bindPopup("Destino").openPopup(); // adiciona marcador no destino

      // Se origem e destino estiverem definidos, tra√ßa a rota
      if (origem && destino) {
        // URL da API OSRM para calcular rota de carro
        const url = `https://router.project-osrm.org/route/v1/driving/${origem[1]},${origem[0]};${destino[1]},${destino[0]}?overview=full&geometries=geojson`;
        const response = await fetch(url); // faz requisi√ß√£o para API
        const data = await response.json(); // transforma resposta em JSON
        const coords = data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]); // ajusta coordenadas para Leaflet

        // Remove rota antiga, se existir
        if (rota) map.removeLayer(rota);

        // Desenha nova rota no mapa
        rota = L.polyline(coords, {color: 'blue'}).addTo(map);

        // Ajusta o zoom para caber toda a rota na tela
        map.fitBounds(rota.getBounds());
      }
    });

    // Fun√ß√£o chamada ao clicar no bot√£o "Iniciar Corrida"
    function iniciarCorrida() {
      if (origem && destino) {
        // Mostra alerta com origem e destino
        alert("üöñ Corrida iniciada!\nOrigem: " + origem + "\nDestino: " + destino);
      } else {
        // Caso usu√°rio n√£o tenha escolhido destino ainda
        alert("‚ö†Ô∏è Escolha um destino clicando no mapa antes de iniciar a corrida!");
      }
    }
  </script>
</body>
</html>
